## 1. Таблица соответствия идентификаторов (Mapping Table)
Для обеспечения совместимости между Legacy-системой (INT), пожеланиями геймдизайнеров (Slugs) и новой архитектурой (UUID) внедрена единая таблица маппинга.

| Имя в JSON (от ГД) | Технический слаг (Slug) | Legacy ID (INT) | Внутренний UUID (Primary Key) |
| :--- | :--- | :--- | :--- |
| **Joseph Stalin** | `sov_stalin` | 1046 | `550e8400-e29b-41d4-a716-446655440000` |
| **sov_trotsky** | `sov_trotsky` | **1105** | `671e8400-e29b-41d4-a716-446655440001` |
| **Winston Churchill** | `eng_churchill` | **1099** | `671e8400-e29b-41d4-a716-446655440002` |
| **USA_FDR** | `usa_fdr` | 1049 | `671e8400-e29b-41d4-a716-446655440003` |
| **Hirohito** | `jap_hirohito` | **1140** | `671e8400-e29b-41d4-a716-446655440004` |

# Документация системы динамических параметров лидеров

## 1. Маппинг данных
Было выявлено несоответствие между Legacy  legacy_id (INT) (Integer) и требованиями ГД (String Slugs). 
Для решения внедрена таблица `LEADERS_MAPPING`.

**Выявленные проблемы в исходных данных:**
- Использование полных имен с пробелами (Joseph Stalin) вместо технических ключей.
- Отсутствие префиксов стран (Hirohito вместо jap_hirohito).
- Неконсистентный регистр (USA_FDR).

## 2. Алгоритм импорта данных
Для предотвращения деградации продакшна используется следующий алгоритм:
1. **Нормализация:** Перед записью в БД все ключи проходят процедуру `trim()` и `to_lower_case()`.
2. **Валидация:** Сверка со справочником `LEADERS_MAPPING`.

3. **Транзакционность:** Запись в БД выполняется атомарно (BEGIN/COMMIT).

## 4. Логика динамических комбо (Rule Engine)
Система поддерживает вычисление скрытых трейтов на лету. 

## 5. Алгоритм безопасной заливки данных (Traits System)
Валидация (Pre-check): Скрипт сверяет JSON от ГД с таблицей leader_mapping.csv. Если в JSON есть имя, которого нет в маппинге — стоп процесс.
Трансформация: Все слаги приводятся к нижнему регистру (lowercase), имена заменяются на технические  legacy_id (INT).
Транзакционность: Заливка в БД происходит внутри одной SQL-транзакции (BEGIN ... COMMIT). Если на любой строке возникнет ошибка, база автоматически откатится к исходному состоянию.
Smoke Test: После заливки сервис автоматически дергает API для Сталина ( legacy_id (INT) 1046). Если данные пришли — деплой успешен.
Мониторинг: Включаем логирование ошибок на 1 час. При росте 500-х ошибок — немедленный откат (Rollback).


