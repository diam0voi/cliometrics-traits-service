# Алгоритм безопасной заливки данных (Traits System)

1. **Валидация (Pre-check):** Скрипт сверяет JSON от ГД с таблицей `leader_mapping.csv`. Если в JSON есть имя, которого нет в маппинге — стоп процесс.
2. **Трансформация:** Все слаги приводятся к нижнему регистру (lowercase), имена заменяются на технические ID.
3. **Транзакционность:** Заливка в БД происходит внутри одной SQL-транзакции (`BEGIN` ... `COMMIT`). Если на любой строке возникнет ошибка, база автоматически откатится к исходному состоянию.
4. **Smoke Test:** После заливки сервис автоматически дергает API для Сталина (ID 1046). Если данные пришли — деплой успешен.
5. **Мониторинг:** Включаем логирование ошибок на 1 час. При росте 500-х ошибок — немедленный откат (Rollback).